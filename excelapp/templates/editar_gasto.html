{% extends 'base.html' %}
{% block content %}
<div class="card shadow border my-4 p-4">
    <h3 class="card-title mb-4">Editar Gasto</h3>
    <form method="post" class="row g-3">
        {% csrf_token %}
        <div class="col-md-4">
            {{ form.fecha.label_tag }} 
            {{ form.fecha }}
        </div>
        <div class="col-md-4">
            {{ form.categoria.label_tag }} 
            {{ form.categoria }}
        </div>
        <div class="col-md-4">
            {{ form.placa.label_tag }} 
            {{ form.placa }}
        </div>
        <div class="col-md-6">
            {{ form.conductor.label_tag }} 
            {{ form.conductor }}
        </div>
        <div class="col-md-6">
            {{ form.precio.label_tag }}
            <input type="text" name="precio" id="id_precio" class="form-control" value="{{ form.precio.value|default_if_none:'' }}">
        </div>
        <div class="col-12">
            <button type="submit" class="btn btn-primary mt-3">Guardar Cambios</button>
            <a href="{% url 'mi_app:gastos_lista' %}" class="btn btn-secondary mt-3">Cancelar</a>
        </div>
    </form>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function () {
      const totalInput = document.getElementById('id_precio');
    
      function formatNumberToPesos(value) {
        value = value.replace(/\D/g, ''); // eliminar todo excepto n√∫meros
        if (!value) return '';
        return '$' + parseInt(value, 10).toLocaleString('es-CO');
      }
    
      function cleanPesos(value) {
        return value.replace(/[^\d]/g, ''); // eliminar $ y puntos
      }
    
      totalInput.addEventListener('input', function () {
        let rawValue = totalInput.value;
        let cursorPos = totalInput.selectionStart;
    
        const cleanedBefore = cleanPesos(rawValue.substring(0, cursorPos));
        const isFirstChar = cleanedBefore.length === 1 && cleanPesos(rawValue).length === 1;
    
        const cleaned = cleanPesos(rawValue);
        const formatted = formatNumberToPesos(cleaned);
    
        totalInput.value = formatted;
    
        if (isFirstChar) {
          totalInput.setSelectionRange(formatted.length, formatted.length);
        } else {
          const newCursorPos = formatted.length - (cleanPesos(formatted).length - cleanedBefore.length);
          totalInput.setSelectionRange(newCursorPos, newCursorPos);
        }
      });
    
      totalInput.form.addEventListener('submit', function () {
        totalInput.value = cleanPesos(totalInput.value);
      });
    });
    </script>
    
{% endblock %}